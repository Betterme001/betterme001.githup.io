<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语法题目复习系统</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-treeview/1.2.0/bootstrap-treeview.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-treeview/1.2.0/bootstrap-treeview.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- 管理界面 -->
        <div class="management-screen" id="managementScreen">
        <div class="header">
                <h1 class="header-title">
                    <span class="header-text-white">语法题目复习系统</span>
                    <span class="header-text-lightgreen" id="headerLightProgress">语法题目复习系统</span>
                    <span class="header-text-darkgreen" id="headerDarkProgress">语法题目复习系统</span>
                </h1>
            <p>每天20分钟，坚持3年，成就非凡人生</p>
            <div style="margin-top:8px;">
                <select id="bankSelect" onchange="switchBank(this.value)" style="padding:6px 10px; border-radius:6px;">
                    <option value="default">默认题库</option>
                    <option value="test2" selected>测试题库2(含加粗)</option>
                </select>
            </div>
        </div>
            <div class="progress-info" id="progressInfo">
                <div class="progress-item">测试进度：<span id="testProgress">0</span> / <span id="totalQuestions">0</span></div>
                <div class="progress-item">复习进度：<span id="reviewProgress">0</span> / <span id="totalQuestions2">0</span></div>
                <div class="progress-item">掌握程度：<span id="reviewedCount">0</span> / <span id="totalReviewed">0</span></div>
            </div>
            <div class="time-info" id="timeInfo">
                <div class="time-stats">
                    <div class="time-item">今日学习：0分钟</div>
                    <div class="time-item">今日题目：0 道</div>
                </div>
            </div>
            <div class="history-info" id="historyInfo" style="display: none;">
                <div class="history-stats">
                    <div class="history-item">历史学习数据</div>
                    <div class="history-list" id="historyList">
                        <!-- 历史数据将在这里动态显示 -->
                    </div>
                </div>
            </div>
            <div class="management-buttons">
                <button class="mgmt-btn review" onclick="startReview()">开始复习</button>
                <button class="mgmt-btn test" onclick="startTest()">开始测试</button>
                <button class="mgmt-btn outline" onclick="showGrammarBox()">我的盒子</button>
                <button class="mgmt-btn library" onclick="showQuestionBank()">展示题库</button>
                <button class="mgmt-btn stats" onclick="showStatsScreen()">学习统计</button>
            </div>
        </div>

        <!-- 测试屏幕 -->
        <div id="testScreen" style="display: none;">
            <div class="progress-container">
                <button class="icon-back progress-back-btn" aria-label="返回" onclick="backToManagement()">←</button>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <button class="icon-back progress-fav-btn" id="favBtn" aria-label="收藏" title="收藏/取消收藏当前题目" onclick="toggleFavorite()">★</button>
            </div>
            <div class="card">
                <div class="overall-progress" id="overallProgressTop"></div>
                <div class="question" id="questionText"></div>
                <div class="review-count" id="reviewCountText"></div>
                <div class="mastery-score" id="masteryScoreText"></div>
                
                <div class="answer-container">
                    <div class="timer" id="timer">
                        <svg viewBox="0 0 40 40">
                            <!-- 使用 r=17, stroke-width=6，避免被裁剪 -->
                            <circle class="timer-circle-bg" cx="20" cy="20" r="17"></circle>
                            <circle class="timer-circle-progress" cx="20" cy="20" r="17"></circle>
                        </svg>
                    </div>
                    <div class="answer-section" id="answerSection">
                        <div class="translation" id="translationText"></div>
                        <!-- 知识点在翻译与按钮之间展示 -->
                        <div class="knowledge-below" id="knowledgeBelow"></div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-mastered" id="masteredBtn" onclick="selectAnswer('mastered')">掌握</button>
                    <button class="btn btn-unclear" id="unclearBtn" onclick="selectAnswer('unclear')">模糊</button>
                    <button class="btn btn-forgot" id="forgotBtn" onclick="selectAnswer('forgot')">忘记</button>
                    <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">下一题</button>
                </div>
            </div>
     
            
        </div>

        <!-- 完成屏幕 -->
        <div class="completion-screen" id="completionScreen">
            <div class="completion-title">测试完成！</div>
            <div id="completionList" class="completion-list"></div>
            <button class="restart-btn" onclick="backToManagement()">返回管理界面</button>
        </div>

        <!-- 题库展示屏幕 -->
        <div class="library-screen" id="libraryScreen">
            <div style="display:flex; justify-content: space-between; align-items:center; padding:8px; flex-wrap: wrap; gap:8px;">
                <button class="icon-back" aria-label="返回" onclick="backToManagement()">←</button>
                <div style="display:flex; align-items:center; gap:8px; flex-wrap: wrap;">
                    <button class="mgmt-btn" onclick="handleResetMastery('clear')" style="background: #f44336; font-size: 0.9rem; padding: 4px 8px; border:none; border-radius:4px; color:#fff; cursor:pointer;">
                        清空M
                    </button>
                    <button class="mgmt-btn" onclick="handleResetMastery('set50')" style="background: #2196F3; font-size: 0.9rem; padding: 4px 8px; border:none; border-radius:4px; color:#fff; cursor:pointer;">
                        50%M
                    </button>
                    <button id="sortByMasteryBtn" onclick="toggleSortByMastery()" style="padding:4px 8px; border:1px solid #ccc; border-radius:4px; background:#fff; font-size:0.9rem; cursor:pointer;">排序M</button>
                    <button id="clearAllFavoritesBtn" onclick="clearAllFavorites()" style="padding:4px 8px; border:1px solid #ccc; border-radius:4px; background:#fff; font-size:0.9rem; cursor:pointer; color:#d32f2f;">取消收藏</button>
                    <label style="font-size:0.95rem; color:#333; display:flex; align-items:center; gap:6px;">
                        <input type="checkbox" id="favOnlyToggle" onchange="showQuestionBank()" /> 收藏
                    </label>
                </div>
            </div>
            <div class="library-list" id="libraryList">
                <!-- 题库内容将在这里动态生成 -->
            </div>
        </div>

        <!-- 学习统计屏幕 -->
        <div class="library-screen" id="statsScreen" style="display: none;">
            <div class="stats-header">
                <button class="icon-back stats-back-btn" aria-label="返回" onclick="backToManagement()">←</button>
                <div class="stats-mode-buttons">
                    <button class="mode-btn active" data-mode="chart" onclick="switchStatsMode('chart')">曲线图</button>
                    <button class="mode-btn" data-mode="heatmap" onclick="switchStatsMode('heatmap')">热力图</button>
                    <button class="mode-btn" data-mode="list" onclick="switchStatsMode('list')">列表</button>
                </div>
            </div>
            <div class="stats-content">
                <div class="library-list" id="statsList" style="display: none;">
                    <!-- 学习统计将在这里动态生成 -->
                </div>
                <div class="chart-container" id="chartContainer">
                    <canvas id="statsChart"></canvas>
                </div>
                <div class="heatmap-container" id="heatmapContainer" style="display: none;">
                    <div class="heatmap-grid" id="heatmapGrid"></div>
                    <div class="heatmap-legend">
                        <div class="legend-title">学习时间等级</div>
                        <div class="legend-items">
                            <div class="legend-item" style="background-color: #f5faf5;">0-19分钟 (不及格)</div>
                            <div class="legend-item" style="background-color: #c6e48b;">20-30分钟 (及格)</div>
                            <div class="legend-item" style="background-color: #7bc96f;">31-40分钟 (良好)</div>
                            <div class="legend-item" style="background-color: #40a9ff;">41-50分钟 (良好+)</div>
                            <div class="legend-item" style="background-color: #1890ff;">51-70分钟 (优秀)</div>
                            <div class="legend-item" style="background-color: #096dd9;">71-90分钟 (优秀+)</div>
                            <div class="legend-item" style="background-color: #003a8c;">90分钟以上 (卓越)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 语法盒子屏幕 -->
        <div class="outline-screen" id="outlineScreen" style="display: none;">
            <div class="outline-header">
                <button class="icon-back" aria-label="返回" onclick="backToManagement()">←</button>
                <h2 id="outlineTitle">语法大纲</h2>
            </div>
            <div class="outline-content" id="outlineContent">
                <!-- 大纲内容将在这里动态加载 -->
            </div>
            <div id="outlineTree" style="display: none;">
                <!-- TreeView将在这里渲染 -->
            </div>
        </div>
    </div>

    <!-- 配置层 -->
    <script src="config.js"></script>
    
    <!-- 模型层 -->
    <script src="models/storage.js"></script>
    <script src="models/questions.js"></script>
    
    <!-- 服务层 -->
    <script src="services/times.js"></script>
    
    <!-- 视图层 -->
    <script src="views/uiManager.js"></script>
    <script src="views/statsCharts.js"></script>
    
    <!-- 控制器层 -->
    <script src="controllers/progressShow.js"></script>
    <script src="controllers/test.js"></script>
    <script src="controllers/bankManager.js"></script>
    <script src="controllers/box_outline.js"></script>
    <script src="controllers/app.js"></script>

</body>
</html>